<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HanName Name Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Noto+Serif+TC:wght@400;500&display=swap" rel="stylesheet" />
<style>
  :root{
    --paper:#F7F5F0;
    --ink:#1E1E1E;
    --muted:#666;
    --gold:#c69d4e;
  }
  body{
    background:var(--paper);
    color:var(--ink);
    line-height:1.8;
    padding:20px;
    font-family:'Noto Serif TC','Cormorant Garamond',serif; /* 中文統一思源宋體 */
    overflow-x:hidden;
  }
  h1{
    font-family:'Cormorant Garamond',serif;
    font-size:clamp(28px,5vw,48px);
    text-align:center;
    margin-bottom:10px;
  }
  .question{
    margin:30px auto;
    max-width:760px;
    background:#fff;
    padding:20px 24px;
    border-radius:14px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
  }
  .question h2{
    font-family:'Cormorant Garamond','Noto Serif TC',serif;
    font-size:20px;
    margin-bottom:10px;
    line-height:1.5;
  }
  .question h2 .req{
    color:#b60000; margin-left:6px; font-family:'Noto Serif TC',serif;
  }
  .sub{ color:var(--muted); font-size:14px; margin-top:2px; }
  .answer-area{
    display:flex; flex-wrap:wrap; gap:10px; margin-top:8px;
  }
  .choice{
    position:relative;
    padding:10px 16px;
    border-radius:22px;
    border:1px solid #ccc;
    cursor:pointer; user-select:none;
    transition:transform .12s ease, box-shadow .2s ease, border-color .2s ease;
    outline:none;
  }
  .choice:hover{ transform:translateY(-1px); }
  .choice:focus-visible{ box-shadow:0 0 0 3px rgba(198,157,78,.25); }

  /* ✅ 統一的「筆刷圓圈」效果（Q2～Q5 全部同一效果） */
  .choice.selected{
    border-color:var(--gold);
    box-shadow:0 2px 10px rgba(198,157,78,.18);
    background-image:
      url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg xmlns="http://www.w3.org/2000/svg" width="240" height="72" viewBox="0 0 240 72"><ellipse cx="120" cy="36" rx="92" ry="26" fill="none" stroke="%23c69d4e" stroke-width="7" stroke-linecap="round" opacity="0.65"/></svg>');
    background-repeat:no-repeat;
    background-position:center;
    background-size:120% 140%;
  }

  input[type="text"],input[type="date"]{
    width:100%; padding:10px; font-size:16px;
    border:1px solid #ccc; border-radius:6px;
    font-family:'Noto Serif TC','Cormorant Garamond',serif;
  }

  .error{ color:#b60000; font-size:14px; margin-top:6px; display:none; }
  .error.show{ display:block; }

  button{
    display:block; margin:30px auto; padding:12px 24px;
    background:#1E1E1E; color:#fff; border:none; border-radius:24px;
    font-size:18px; cursor:pointer; transition:background .2s;
  }
  button:hover{ background:#333; }
  .note{ font-size:14px; color:var(--muted); }

  @media (max-width:520px){
    .choice{ width:100%; text-align:center; }
  }

  /* ===== 生成中 Modal ===== */
  .modal-backdrop{
    position:fixed; inset:0;
    background:rgba(0,0,0,.55);
    display:none; /* show by adding .show */
    align-items:center; justify-content:center;
    z-index:9999;
  }
  .modal-backdrop.show{ display:flex; }
  .modal-card{
    width:min(720px,92vw);
    background:#fff;
    border-radius:16px;
    padding:22px 22px 28px;
    box-shadow:0 14px 50px rgba(0,0,0,.35);
    position:relative;
    overflow:hidden;
  }
  .modal-title{
    font-family:'Cormorant Garamond',serif;
    font-size:clamp(22px,4vw,28px);
    margin-bottom:6px;
    text-align:center;
  }
  .modal-sub{
    text-align:center; color:#666; margin-bottom:16px;
    font-family:'Noto Serif TC',serif;
  }
  .progress{
    height:10px; width:100%;
    background:#eee; border-radius:999px;
    overflow:hidden; margin:0 auto 6px;
  }
  .bar{
    height:100%; width:0%;
    background:linear-gradient(90deg, #c69d4e, #e3d2a7);
    transition:width .2s linear;
  }
  .percent{
    text-align:center; font-size:14px; color:#444; margin-bottom:8px;
  }

  /* 飄落中文字容器 */
  .char-field{
    position:absolute; inset:0; overflow:hidden; pointer-events:none;
  }
  .char{
    position:absolute;
    font-family:'Noto Serif TC',serif;
    color:#1E1E1E;
    opacity:.08;
    font-size: clamp(20px, 4.2vw, 46px);
    transform:translate(-50%, -50%);
    animation: drift 4.2s linear forwards;
    white-space:nowrap;
  }
  @keyframes drift{
    0%   { transform:translate(-50%,-50%) scale(0.9); opacity:.00; }
    10%  { opacity:.12; }
    90%  { opacity:.12; }
    100% { transform:translate(-50%, -50%) translateY(60px) scale(1.04); opacity:0; }
  }
</style>
</head>
<body>
  <h1>HanName Name Quiz<br><small>Find Your Chinese Name</small></h1>

  <!-- Q1 必填 -->
  <div class="question" id="Q1">
    <h2>1. What is your full English name?<span class="req">*</span><br>
      <span class="sub">請問你的英文全名是？（例如 John Michael Smith）</span>
    </h2>
    <input type="text" id="q1" placeholder="e.g. John Michael Smith" aria-required="true" />
    <div class="error" id="e1">This field is required. 此題為必填。</div>
  </div>

  <!-- Q2 必填：保留英文姓氏 -->
  <div class="question" id="Q2">
    <h2>2. Do you want to keep your English last name as your Chinese surname abbreviation?<span class="req">*</span><br>
      <span class="sub">是否要保留你的英文姓氏作為中文姓氏的簡稱？（中文姓氏大部分只有一個字）</span>
    </h2>
    <div class="answer-area" id="q2" role="group" aria-label="Surname Preference">
      <div class="choice" tabindex="0" role="button" aria-pressed="false" data-value="yes">是 / Yes</div>
      <div class="choice" tabindex="0" role="button" aria-pressed="false" data-value="no">否 / No</div>
    </div>
    <div class="error" id="e2">Please choose one. 請擇一。</div>
  </div>

  <!-- Q3 必填：形容詞（從下列中圈選 5 個） -->
  <div class="question" id="Q3">
    <h2>3. Which 5 adjectives best describe you?<span class="req">*</span><br>
      <span class="sub">你覺得哪 5 個形容詞最符合你？（從下列中圈選 5 個）</span>
    </h2>
    <div class="answer-area" id="q3" role="group" aria-label="Adjectives (pick 5)"></div>
    <div class="error" id="e3">Please pick exactly 5. 請勾選 5 個。</div>
  </div>

  <!-- Q4 必填：用途（單選） -->
  <div class="question" id="Q4">
    <h2>4. What will you mainly use this Chinese name for?<span class="req">*</span><br>
      <span class="sub">這個中文名字你主要用在那個用途？（單選）</span>
    </h2>
    <div class="answer-area" id="q4" role="group" aria-label="Main Purpose (single)"></div>
    <div class="error" id="e4">Please choose one. 請擇一。</div>
  </div>

  <!-- Q5 必填：想要的感覺（選 3 個） -->
  <div class="question" id="Q5">
    <h2>5. What kind of feeling do you want your Chinese name to have? (choose 3)<span class="req">*</span><br>
      <span class="sub">你希望你的中文名字聽起來有什麼樣的感覺？（選 3 個）</span>
    </h2>
    <div class="answer-area" id="q5" role="group" aria-label="Name Feeling (pick 3)"></div>
    <div class="error" id="e5">Please pick exactly 3. 請勾選 3 個。</div>
  </div>

  <!-- Q6 非必填：生日 -->
  <div class="question" id="Q6">
    <h2>6. Would you like to provide your birthday for name reference? (optional)<br>
      <span class="sub">是否提供你的生日作為名字參考（非必填；中國人會參考生日命理當作取名評估）</span>
    </h2>
    <input type="date" id="q6" />
    <p class="note">You can skip this. 可略過此題。</p>
  </div>

  <button id="submitBtn" aria-label="Submit to see result">送出看結果 / Submit</button>

  <!-- 生成中 Modal -->
  <div class="modal-backdrop" id="genModal" aria-hidden="true" role="dialog" aria-label="Generating your Chinese name">
    <div class="modal-card">
      <div class="char-field" id="charField"></div>
      <h3 class="modal-title">Designing your Chinese name…</h3>
      <p class="modal-sub">正在設計你的中文姓名，請稍候</p>
      <div class="progress"><div class="bar" id="bar"></div></div>
      <div class="percent" id="percent">0%</div>
    </div>
  </div>

<script>
  // ====== 原先提供的中文選項（加上英文對照） ======
  const adjectives = [
    "安靜 / quiet","活潑 / lively","專注 / focused","可愛 / cute","自信 / confident",
    "沉穩 / calm","健談 / talkative","熱情 / passionate","憂鬱 / melancholic","神秘 / mysterious",
    "害怕 / fearful","多元的 / diverse","開放的 / open","聰明 / smart","有趣 / interesting",
    "好動的 / active","優雅的 / elegant","領導的 / leadership","和氣的 / kind","好學的 / studious"
  ];
  const purposes = [
    "我要去中國讀書 / Studying in China",
    "商務用途 / Business use",
    "我是國外華人希望有自己的中文名字 / Overseas Chinese wanting a Chinese name",
    "新生兒命名 / Baby naming",
    "純粹自己紀念好玩 / Just for fun"
  ];
  const feels = [
    "優雅的 / elegant","輕鬆的 / relaxed","有趣的 / fun","聰明的 / smart","幹練的 / capable",
    "簡潔的 / simple","好念的 / easy to pronounce","有歷史意義的 / historical",
    "有故事的 / meaningful","新潮的 / trendy","神秘的 / mysterious","熱情的 / passionate"
  ];

  // ====== 建立選項（統一「筆刷圓圈」效果；單選/多選皆可） ======
  function buildChoices(list, containerId, mode='multi', limit=null){
    const area = document.getElementById(containerId);
    area.innerHTML = '';
    list.forEach(txt=>{
      const div = document.createElement('div');
      div.className = 'choice';
      div.tabIndex = 0;
      div.setAttribute('role','button');
      div.setAttribute('aria-pressed','false');
      div.textContent = txt;
      area.appendChild(div);
    });

    function toggleChoice(el){
      if(!el || !el.classList.contains('choice')) return;

      if(mode === 'single'){
        // 單選：清除其他、只留自己（同一筆刷圓圈效果）
        area.querySelectorAll('.choice').forEach(c=>{
          c.classList.remove('selected');
          c.setAttribute('aria-pressed','false');
        });
        el.classList.add('selected');
        el.setAttribute('aria-pressed','true');
      }else{
        // 多選：限制數量（同一筆刷圓圈效果）
        const selectedCount = area.querySelectorAll('.choice.selected').length;
        if(el.classList.contains('selected')){
          el.classList.remove('selected');
          el.setAttribute('aria-pressed','false');
        }else{
          if(limit && selectedCount >= limit) return;
          el.classList.add('selected');
          el.setAttribute('aria-pressed','true');
        }
      }
    }

    // 滑鼠
    area.addEventListener('click', (e)=>{
      if(e.target.classList.contains('choice')) toggleChoice(e.target);
    });
    // 鍵盤（Enter/Space）
    area.addEventListener('keydown', (e)=>{
      if(!e.target.classList.contains('choice')) return;
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault(); toggleChoice(e.target);
      }
    });
  }

  // ====== 初始化（Q2~Q5 皆為統一「筆刷圓圈」效果） ======
  buildChoices(["是 / Yes","否 / No"], 'q2', 'single');
  buildChoices(adjectives, 'q3', 'multi', 5);
  buildChoices(purposes, 'q4', 'single');
  buildChoices(feels, 'q5', 'multi', 3);

  // ====== 驗證＆送出 ======
  function firstSelectedText(containerId){
    const sel = document.querySelectorAll('#'+containerId+' .choice.selected');
    return sel.length ? sel[0].textContent : null;
  }
  function selectedTexts(containerId){
    return Array.from(document.querySelectorAll('#'+containerId+' .choice.selected'))
      .map(el=>el.textContent);
  }
  function scrollToShow(el){ el.scrollIntoView({behavior:'smooth', block:'center'}); }

  // ====== 生成中 Modal 控制 ======
  const modal = document.getElementById('genModal');
  const bar = document.getElementById('bar');
  const percent = document.getElementById('percent');
  const charField = document.getElementById('charField');

  // 一批適合飄落的常見字（也含一些部首，提高視覺多樣性）
  const pool = "山水木火金土日月風花雨雲星海林川原心和雅清思文語學安恆靜光晨夜夢詩樂羽辰玄衡宸翊承琛宇然諾沐言寧昕逸芊朵昀北南東西景希哲柏庭禾祐昫曜睿齊凜涵玥璟珩珞珂珀".split("");

  function spawnChar(){
    const el = document.createElement('div');
    el.className = 'char';
    el.textContent = pool[Math.floor(Math.random()*pool.length)];
    // 隨機位置與速度
    const vw = Math.random()*100;     // 0-100 vw
    const vh = Math.random()*100;     // 0-100 vh
    const delay = Math.random()*200;  // ms
    el.style.left = vw + '%';
    el.style.top  = vh + '%';
    el.style.animationDuration = (3.5 + Math.random()*1.8) + 's';
    el.style.animationDelay = (delay/1000) + 's';
    charField.appendChild(el);
    // 清理
    setTimeout(()=> el.remove(), 5000);
  }

  function startGenerationAnimation(totalMs, onDone){
    // reset
    percent.textContent = '0%';
    bar.style.width = '0%';
    modal.classList.add('show');
    modal.setAttribute('aria-hidden','false');

    const started = performance.now();
    // 字元持續生成
    const spawner = setInterval(()=> {
      for(let i=0;i<3;i++) spawnChar();
    }, 160);

    // 進度條
    function tick(ts){
      const elapsed = ts - started;
      const p = Math.min(1, elapsed / totalMs);
      const pct = Math.floor(p*100);
      bar.style.width = pct + '%';
      percent.textContent = pct + '%';
      if(p < 1) requestAnimationFrame(tick);
      else{
        clearInterval(spawner);
        // 微延遲讓最後一批字 fade 一下
        setTimeout(()=>{
          modal.classList.remove('show');
          modal.setAttribute('aria-hidden','true');
          onDone && onDone();
        }, 260);
      }
    }
    requestAnimationFrame(tick);
  }

  document.getElementById('submitBtn').addEventListener('click', ()=>{
    // 清除錯誤
    ['e1','e2','e3','e4','e5'].forEach(id=>document.getElementById(id).classList.remove('show'));

    const name = (document.getElementById('q1').value || '').trim();
    if(!name){ document.getElementById('e1').classList.add('show'); return scrollToShow(document.getElementById('Q1')); }

    const q2Ans = firstSelectedText('q2');
    if(!q2Ans){ document.getElementById('e2').classList.add('show'); return scrollToShow(document.getElementById('Q2')); }

    const q3Ans = selectedTexts('q3');
    if(q3Ans.length !== 5){ document.getElementById('e3').classList.add('show'); return scrollToShow(document.getElementById('Q3')); }

    const q4Ans = firstSelectedText('q4');
    if(!q4Ans){ document.getElementById('e4').classList.add('show'); return scrollToShow(document.getElementById('Q4')); }

    const q5Ans = selectedTexts('q5');
    if(q5Ans.length !== 3){ document.getElementById('e5').classList.add('show'); return scrollToShow(document.getElementById('Q5')); }

    const birthday = document.getElementById('q6').value || 'N/A';

    // 把答案帶去結果頁（用 sessionStorage）
    const payload = {
      name, keepSurname:q2Ans, adjectives:q3Ans, purpose:q4Ans, feels:q5Ans, birthday
    };
    try{ sessionStorage.setItem('hanname_quiz_answers', JSON.stringify(payload)); }catch(e){}

    // ✅ 題目皆完成 → 顯示生成中視窗（約 4 秒），完成後導往結果頁
    startGenerationAnimation(4000, function(){
      window.location.href = 'result.html';
    });
  });
</script>
</body>
</html>

